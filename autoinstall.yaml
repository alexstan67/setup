autoinstall:
  version: 1
  source:
    id: ubuntu-desktop-minimal
    search_drivers: true
  interactive-sections:
    - network
    - storage
    - keyboard
    - identity
  fallback: offline-install
  geoip: true
  locale: fr_FR.UTF-8
  keyboard:
    layout: fr
  timezone: Europe/Paris 
  identity:
    username: alex
    realname: 'Alexandre Stanescot'
    hostname: lap-002
    password: '$y$j9T$onYRFpkfFmI4Ej6D/iya8.$qf63VzoeTH2PDG/vNNA31Os6GCxMlK0SVp/PGaI1Qe6'
  packages:
    - git
    - gh
    - usb-creator-gtk
    - python3-pip
    - vim
    - lynx
    - tree
    - gimp
    - imagemagick
    - vlc
    - inkscape
    - qalc
    - gpick
    - exiv2
    - easytag
    - figlet
    - mat2
    - kleopatra
    - neofetch
    - qrencode
    - xournalpp
    - font-manager
    - testdisk
    - openscad
    - librecad
    - stellarium
    - nextcloud-desktop
    - nautilus-nextcloud
    - qemu-system
    - virt-manager
    - bridge-utils
    - zsh
    - curl
    - net-tools
    - whois
    - nmap
    - traceroute
    - transmission
    - metadata-cleaner
    - timeshift
  snaps:
    - name: postman
    - name: thunderbird
    - name: brave
    - name: cherrytree
    - name: dbeaver-ce 
    - name: projectlibre
    - name: cups
    - name: marble
    - name: torrhunt
    - name: signal-desktop
    - name: podcasts
    - name: slack
  shutdown: reboot
  ssh:
    allow-pw: true
    authorized-keys:
      - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAICE7b1TJ+Yt7so8FIzJ1Pi9dVMKCi7A2ORZEVPAn4Qaz alex@nuc-001
      - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEDr4Q1mWAVGpiuEymvzrWIYci4kMt905Z58qwM3UQo1 alex@lap-001
      - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIMztCBrDdh/rX8wz2J5VXNFvxYxfhaYHLLGHWil85etL deploy@vps-001
      - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEsRFnLaky0198x03lLZg4miHQv6uW8i9q4pRHVTQ5zJ alex@vps-002
      - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIFTFnB6Gr7RRubPDIQIiWwO76+ft7Ykf1+pUeCpoQyil deploy@mac-001
      - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGPYtW42/G3oyxUmcT9E1ky8kskFCJd4gRmAz+xu2SwZ alex@lap-002
    install-server: false
  codecs:
    install: true
  drivers:
    install: true
  late-commands:
    - curtin in-target -- systemctl enable libvirtd.service
    - curtin in-target -- systemctl start libvirtd.service
    - curtin in-target -- sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
    - curtin in-target -- mkdir -p /home/alex/Github /home/alex/Apps /home/alex/Git /home/alex/VMs /home/alex/Downloads
    - curtin in-target -- chmod 777 /etc/lynx/lynx.cfg
    - curtin in-target -- echo 'ACCEPT_ALL_COOKIES:TRUE' >> /etc/lynx/lynx.cfg
    - curtin in-target -- chown alex:root /etc/hosts
    - curtin in-target -- echo '192.168.77.16	 nas-001' >> /etc/hosts
    - curtin in-target -- echo '192.168.77.19	 mac-001' >> /etc/hosts
    - curtin in-target -- echo '54.37.152.178  vps-001' >> /etc/hosts
    - curtin in-target -- echo '51.210.106.100 vps-002' >> /etc/hosts
    - curtin in-target -- echo '141.94.17.140  vps-003' >> /etc/hosts
    - curtin in-target -- ufw default allow outgoing
    - curtin in-target -- ufw default deny incoming
    - curtin in-target -- ufw allow 80      #http
    - curtin in-target -- ufw allow 443     #https
    - curtin in-target -- ufw allow 22      #ssh
    - curtin in-target -- ufw allow 993     #imaps
    - curtin in-target -- ufw allow 25      #smtp
    - curtin in-target -- ufw allow 631     #ipp printers
    - curtin in-target -- ufw allow 15001   #nas
    - curtin in-target -- ufw allow 5432    #postgresql
    - curtin in-target -- ufw allow 11194   #openvpn
    - curtin in-target -- ufw enable
    - curtin in-target -- cd /home/alex/Downloads && wget https://ftp.hp.com/pub/softlib/software13/printers/SS/SL-M4580FX/uld_V1.00.39_01.17.tar.gz 
    - curtin in-target -- apt update && apt -y upgrade && apt autoclean && apt -y autoremove
    - curtin in-target -- sh -c "$(curl -fsSL https://raw.githubusercontent.com/as-consult/setup/main/post-install.sh)"
# https://canonical-subiquity.readthedocs-hosted.com/en/latest/reference/autoinstall-reference.html
